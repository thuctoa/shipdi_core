<link href="../css/maps.css"/>
<div class="widget-settings-pane"> <div aria-labelledby="widget-pane-section-header-title" role="dialog" class="widget-settings-content"> <div tabindex="0" jsaction="focus:settings.focus.top"> </div> <div class="widget-settings-header"> <div jstcache="307"> <img alt="Google Maps" jstcache="120" src="//www.google.com/images/branding/lockups/1x/lockup_maps_color_131x24dp.png" class="google-logo"> </div> <button aria-label="Đóng" vet="10761" jsaction="settings.close" class="maps-sprite-settings-chevron-left widget-settings-icon-close"></button> </div> <ul class="widget-settings-list"> <li class="widget-settings-list-item"> <div class="widget-settings-earth-item"> <button vet="10766" jstcache="308" jsaction="settings.intent.satellite" class="widget-settings-button widget-settings-earth-button widget-settings-intent-off" jsan="7.widget-settings-button,7.widget-settings-earth-button,7.widget-settings-intent-off,0.vet,22.jsaction"> <div class="widget-settings-button-icon widget-settings-button-icon-default maps-sprite-settings-earth"></div> <div class="widget-settings-button-icon widget-settings-button-icon-hover maps-sprite-settings-earth-blue"></div> <label jstcache="309" class="widget-settings-button-label">Earth</label> <label jstcache="310" class="widget-settings-button-label" style="display:none">Vệ tinh</label> </button> <button jstcache="311" jsaction="settings.intent.labels" class="widget-settings-button widget-settings-labels-button" style="display:none"> <div class="widget-settings-button-icon widget-settings-icon-none"></div> <label jstcache="312" class="widget-settings-sub-button-label" style="display:none">Bật nhãn</label> <label jstcache="313" class="widget-settings-sub-button-label" style="display:none">Tắt nhãn</label> </button> <button jstcache="314" jsaction="settings.intent.threed" class="widget-settings-button widget-settings-labels-button" style="display:none"> <div class="widget-settings-button-icon widget-settings-icon-none"></div> <label jstcache="315" class="widget-settings-sub-button-label" style="display:none">3D tắt</label> <label jstcache="316" class="widget-settings-sub-button-label" style="display:none">3D bật</label> </button> </div> </li> <li class="widget-settings-list-item"> <button disabled="true" vet="10767" jstcache="317" jsaction="settings.intent.traffic" class="widget-settings-button widget-settings-intent-disabled" jsan="7.widget-settings-button,7.widget-settings-intent-disabled,0.disabled,0.vet,22.jsaction"> <div class="widget-settings-button-icon widget-settings-button-icon-default maps-sprite-settings-traffic"></div> <div class="widget-settings-button-icon widget-settings-button-icon-hover maps-sprite-settings-traffic-blue"></div> <label class="widget-settings-button-label">Giao thông</label> </button> </li> <li class="widget-settings-list-item"> <button disabled="true" vet="10768" jstcache="318" jsaction="settings.intent.transit" class="widget-settings-button widget-settings-intent-disabled" jsan="7.widget-settings-button,7.widget-settings-intent-disabled,0.disabled,0.vet,22.jsaction"> <div class="widget-settings-button-icon widget-settings-button-icon-default maps-sprite-settings-transit"></div> <div class="widget-settings-button-icon widget-settings-button-icon-hover maps-sprite-settings-transit-blue"></div> <label class="widget-settings-button-label">Chuyển tuyến</label> </button> </li> <li class="widget-settings-list-item"> <button disabled="true" vet="10769" jstcache="319" jsaction="settings.intent.bike" class="widget-settings-button widget-settings-intent-disabled" jsan="7.widget-settings-button,7.widget-settings-intent-disabled,0.disabled,0.vet,22.jsaction"> <div class="widget-settings-button-icon widget-settings-button-icon-default maps-sprite-settings-bike"></div> <div class="widget-settings-button-icon widget-settings-button-icon-hover maps-sprite-settings-bike-blue"></div> <label class="widget-settings-button-label">Đi xe đạp</label> </button> </li> <li class="widget-settings-list-item"> <button vet="10770" jstcache="320" jsaction="settings.intent.terrain" class="widget-settings-button widget-settings-intent-off" jsan="7.widget-settings-button,7.widget-settings-intent-off,0.vet,22.jsaction"> <div class="widget-settings-button-icon widget-settings-button-icon-default maps-sprite-settings-terrain"></div> <div class="widget-settings-button-icon widget-settings-button-icon-hover maps-sprite-settings-terrain-blue"></div> <label class="widget-settings-button-label">Địa hình</label> </button> </li> </ul> <ul class="widget-settings-list"> <li jstcache="321" class="widget-settings-list-item"> <button vet="10764" jsaction="settings.mymaps" class="widget-settings-button"> <div class="widget-settings-button-icon widget-settings-button-icon-default maps-sprite-settings-my-maps"></div> <div class="widget-settings-button-icon widget-settings-button-icon-hover maps-sprite-settings-my-maps-blue"></div> <label class="widget-settings-button-label">My Maps</label> </button> </li> <li jstcache="322" class="widget-settings-list-item"> <button vet="13255" jsaction="settings.profile" class="widget-settings-button"> <div class="widget-settings-button-icon widget-settings-button-icon-default maps-sprite-settings-rate-review"></div> <div class="widget-settings-button-icon widget-settings-button-icon-hover maps-sprite-settings-rate-review-blue"></div> <label class="widget-settings-button-label">Đóng góp của bạn</label> </button> </li> <li class="widget-settings-list-item"> <button vet="10765" jsaction="settings.share" class="widget-settings-button"> <div class="widget-settings-button-icon widget-settings-button-icon-default maps-sprite-settings-link"></div> <div class="widget-settings-button-icon widget-settings-button-icon-hover maps-sprite-settings-link-blue"></div> <label class="widget-settings-button-label">Chia sẻ hoặc nhúng bản đồ</label> </button> </li> <li class="widget-settings-list-item"> <button vet="11343" jsaction="settings.print" class="widget-settings-button"> <div class="widget-settings-button-icon widget-settings-button-icon-default maps-sprite-settings-print"></div> <div class="widget-settings-button-icon widget-settings-button-icon-hover maps-sprite-settings-print-blue"></div> <label class="widget-settings-button-label">In</label> </button> </li> </ul> <ul class="widget-settings-list"> <li class="widget-settings-list-item"> <button vet="11051" jsaction="settings.tour" class="widget-settings-button">Tham quan</button> </li> <li class="widget-settings-list-item"> <button vet="10775" jsaction="settings.tipsandtricks" class="widget-settings-button">Mẹo và thủ thuật</button> </li> <li jstcache="323" class="widget-settings-list-item" style="display:none"> <button jsaction="settings.edithome" class="widget-settings-button">Chỉnh sửa địa chỉ nhà riêng</button> </li> <li jstcache="324" class="widget-settings-list-item" style="display:none"> <button jsaction="settings.editwork" class="widget-settings-button">Chỉnh sửa địa chỉ cơ quan</button> </li> <li class="widget-settings-list-item"> <button vet="10774" jsaction="settings.help" class="widget-settings-button">Nhận trợ giúp</button> </li> <li jstcache="325" class="widget-settings-list-item"> <button vet="10773" jsaction="settings.rap" class="widget-settings-button">Gửi phản hồi</button> </li> </ul> <ul jstcache="326" class="widget-settings-list" style="display:none"> <li jstcache="327" class="widget-settings-list-item" style="display:none"> <button jstcache="328" jsaction="settings.language" class="widget-settings-button" jsan="7.widget-settings-button,22.jsaction"></button> </li> </ul> <ul jstcache="329" class="widget-settings-list"> <li jstcache="330" class="widget-settings-list-item"> <button vet="10771" jsaction="settings.link.settings" class="widget-settings-button">Cài đặt tìm kiếm</button> </li> <li jstcache="331" style="display:none"> <button jsaction="settings.languages" class="widget-languages-drawer-button widget-settings-button"> Languages (Aअ日中אي) </button> </li> <li jstcache="332" class="widget-settings-list-item"> <button vet="11056" jsaction="settings.link.history" class="widget-settings-button">Lịch sử</button> </li> </ul> <div tabindex="0" jsaction="focus:settings.focus.bottom"> </div> </div> </div>
<div id="map" style="float:left;width:1000px;height:600px;"></div>
<!--<div id="right-panel">
  <p>Total Distance: <span id="total"></span></p>
</div>-->
<?php
    if(count($sobando)>1){
        $len=  count($sobando);

            for($i=0;$i<$len;$i++){
?>
                <a href="/site/location?ngay=<?=$_GET['ngay']?>&ca=<?=$_GET['ca']?>&socum=<?=$_GET['socum']?>&inkhuvuc=<?=$_GET['inkhuvuc']?>&tam=<?=$i?>" 
                    <?php
                        if($_GET['tam']==$i){
                    ?>
                   style="background:  #c7bfbf;"
                    <?php
                        }
                    ?>
                    >Tấm <?=$i?>, </a>
<?php
            }
    }
?>

<script>
    function initMap() {
        var map = new google.maps.Map(document.getElementById('map'), {
            zoom: 4,
            center: {lat: 20.9930851, lng: 105.8259845} // Australia.
        });

        var directionsService = new google.maps.DirectionsService;
        var directionsDisplay = new google.maps.DirectionsRenderer({
            draggable: true,
            map: map,
            panel: document.getElementById('right-panel'),
        });

        directionsDisplay.addListener('directions_changed', function() {
            computeTotalDistance(directionsDisplay.getDirections());
        });
        <?php
            $array=$sobando[$_GET['tam']];
            if(count($array)>10){
        ?>
            var diemdau={
                lat:<?= current($array)['x']?>,
                lng:<?= current($array)['y']?>,
            };
            var diemcuoi={
                lat:<?= $array[9]['x']?>,
                lng:<?= $array[9]['y']?>
            };

            var diemgiua=[];
            <?php
                array_shift($array);
                for($i=1;$i<9;$i++){
            ?>
                    var dg={
                        lat:<?= $array[$i]['x']?>,
                        lng:<?= $array[$i]['y']?>
                    };
                    diemgiua.push({
                                location: dg,
                                stopover: true
                            });
                    
            <?php
                unset($array[$i]);
                }
            ?> 
            displayRoute(diemdau, diemcuoi,diemgiua, directionsService,
                directionsDisplay);
        <?php
            }else{
        ?>
            var diemdau={
                lat:<?= current($array)['x']?>,
                lng:<?= current($array)['y']?>,
            };
            var diemcuoi={
                lat:<?= end($array)['x']?>,
                lng:<?= end($array)['y']?>
            };

            var diemgiua=[];
            <?php
                array_shift($array);
                array_pop($array);
                foreach ($array as $val){
            ?>
                    var dg={
                        lat:<?= $val['x']?>,
                        lng:<?= $val['y']?>
                    };
                    diemgiua.push({
                                location: dg,
                                stopover: true
                            });
            <?php
                }
            ?> 
            displayRoute(diemdau, diemcuoi,diemgiua, directionsService,
                directionsDisplay);
        <?php
        }
        ?>
    }

    function displayRoute(origin, destination,diemgiua ,service, display) {
        
        service.route({
            origin: origin,
            destination: destination,
            waypoints: diemgiua,
            travelMode: google.maps.TravelMode.DRIVING,
            avoidTolls: true
        }, function(response, status) {
            if (status === google.maps.DirectionsStatus.OK) {
              display.setDirections(response);
            } else {
              alert('Could not display directions due to: ' + status);
            }
        });
    }

    function computeTotalDistance(result) {
        var total = 0;
        var myroute = result.routes[0];
        for (var i = 0; i < myroute.legs.length; i++) {
            total += myroute.legs[i].distance.value;
        }
        total = total / 1000;
//        document.getElementById('total').innerHTML = total + ' km';
    }
</script>
<script src="https://maps.googleapis.com/maps/api/js?signed_in=true&callback=initMap"
    async defer></script>
